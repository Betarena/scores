# â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
# â”‚ ğŸ“Œ High Order Overview                                                           â”‚
# â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
# â”‚ â¤ Code Format   // V.8.0                                                         â”‚
# â”‚ â¤ Status        // ğŸ”’ LOCKED                                                     â”‚
# â”‚ â¤ Author(s)     // @migbash                                                      â”‚
# â”‚ â¤ Maintainer(s) // @migbash                                                      â”‚
# â”‚ â¤ Created on    // <date-created>                                                â”‚
# â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
# â”‚ ğŸ“ Description                                                                   â”‚
# â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
# â”‚ BETARENA (Module)
# â”‚ |: Docker Compose Configuration
# â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

name: betarena-scores

services:

  # â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  # â”‚ ğŸŸ¦ â”‚ CONTAINER(s) for :: APPLICATION                                             â”‚
  # â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  nginx:
    image: nginx:1.27.1
    command: |
      nginx -g "daemon off;"
    logging:
      driver: local
      options:
        max-size: 1g
        max-file: 5
    volumes:
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: configuration files
      # â•°â”€â”€â”€â”€â”€
      - ./nginx/config:/etc/nginx/config:ro
      - ./nginx/auth:/etc/nginx/auth:ro
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: access/error logs
      # â•°â”€â”€â”€â”€â”€
      - ./nginx/logs/scores.production:/var/log/nginx/scores.production:rw
      - ./nginx/logs/scores.staging:/var/log/nginx/scores.staging:rw
      - ./nginx/logs/goaccess:/var/log/nginx/goaccess:rw
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: cache files
      # â•°â”€â”€â”€â”€â”€
      - ./nginx/cache/scores.production:/var/cache/nginx/scores_production:rw
      - ./nginx/cache/scores.staging:/var/cache/nginx/scores_staging:rw
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: go-access monitoring
      # â•°â”€â”€â”€â”€â”€
      - ./goaccess:/etc/nginx/html:ro
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: serve of scores application
      # â•°â”€â”€â”€â”€â”€
      - scores-production-volume:/etc/nginx/scores.production/build:ro
      - scores-staging-volume:/etc/nginx/scores.staging/build:ro
    networks:
      - loadbalancer
      - loadbalancer.staging
  #

  scores-production:
    image: ${BETARNA_SCORES__DOCKER_IMAGE:-name4d/betarena:scores-latest}
    restart: always
    deploy:
      replicas: ${BETARNA_SCORES__REPLICAS:-3}
    env_file: ../env/.env.docker.scores.production
    volumes:
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: WARNING:
      # â”‚ |: [disabled] Volume to share scripts, not typically needed, unless experimenting.
      # â•°â”€â”€â”€â”€â”€
      # - ../.scripts:/app/.scripts:rw
      # - ./scores.production/package.json:/app/package.json:ro
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: 'build' output (pure project files)
      # â”œâ”€â”€â”€â”€â”€
      # â”‚ NOTE: (alternative)
      # â”‚ |: - ./scores.production:/app/build:rw
      # â”‚ |:  â”œ not recommended for production usage, as accidental file changes may occur,
      # â”‚ |:  â”œ best to use docker volume for production-like usage.
      # â•°â”€â”€â”€â”€â”€
      - scores-production-volume:/app/build:rw
    expose:
      - 3050
    # â•­â”€â”€â”€â”€â”€
    # â”‚ NOTE:
    # â”‚ |: used for development purposes
    # â•°â”€â”€â”€â”€â”€
    # ports:
    #   - 3000:3000
    logging:
      driver: local
      options:
        max-size: 500m
        max-file: 5
    networks:
      - loadbalancer
  #

  scores-staging:
    image: ${BETARNA_SCORES_STAGING__DOCKER_IMAGE:-name4d/betarena:scores-staging-latest}
    restart: always
    deploy:
      replicas: ${BETARNA_SCORES_STAGING__REPLICAS:-1}
    env_file: ../env/.env.docker.scores.staging
    volumes:
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: WARNING:
      # â”‚ |: [disabled] Volume to share scripts, not typically needed, unless experimenting.
      # â•°â”€â”€â”€â”€â”€
      # - ../.scripts:/app/.scripts:rw
      # - ./scores.staging/package.json:/app/package.json:ro
      # â•­â”€â”€â”€â”€â”€
      # â”‚ NOTE: IMPORTANT
      # â”‚ |: volume for: 'build' output (pure project files)
      # â”œâ”€â”€â”€â”€â”€
      # â”‚ NOTE: (alternative)
      # â”‚ |: - ./scores.staging:/app/build:rw
      # â”‚ |:  â”œ not recommended for production usage, as accidental file changes may occur,
      # â”‚ |:  â”œ best to use docker volume for production-like usage.
      # â•°â”€â”€â”€â”€â”€
      - scores-staging-volume:/app/build:rw
    # expose:
    #   - 6500
    # â•­â”€â”€â”€â”€â”€
    # â”‚ NOTE:
    # â”‚ |: used for development purposes
    # â•°â”€â”€â”€â”€â”€
    # ports:
    #   - 3000:3000
    logging:
      driver: local
      options:
        max-size: 500m
        max-file: 5
    networks:
      - loadbalancer.staging
  #

  # â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  # â”‚ ğŸ§¿ â”‚ CONTAINER(s) for :: MONITORING                                              â”‚
  # â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  goaccess:
    image: allinurl/goaccess:1.9.3
    ports:
      - 7890:7890
    volumes:
      - ./nginx/logs/scores.production:/var/log/nginx:ro
      - ./goaccess:/var/www/goaccess:rw
    command: |
      --config-file=/var/www/goaccess/goaccess.conf
      --log-file=/var/log/nginx/access.log
      --log-format=COMBINED
      --output=/var/www/goaccess/index.html
      --real-time-html
      --ping-interval=5
      --port=7890
      --html-report-title="BetArena - Scores"
    depends_on:
      - nginx
  #
#

networks:
  loadbalancer:
    driver: bridge
  loadbalancer.staging:
    driver: bridge
#

volumes:
  scores-production-volume:
    driver: local
  scores-staging-volume:
    driver: local
#