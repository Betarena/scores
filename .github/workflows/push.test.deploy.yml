# ╭──────────────────────────────────────────────────────────────────╮
# │ 🐙 GITHUB ACIONS CI/CD WORKFLOW                                  │
# ┣──────────────────────────────────────────────────────────────────┫
# │ Responsible for:                                                 │
# ╰──────────────────────────────────────────────────────────────────╯

name: '🔥 // Deployment - staging'

on:
  push:
    branches:
      - test
#

jobs:

  # ╭──────────────────────────────────────────────────────────────────╮
  # │ NOTE:                                                            │
  # │ ➤ [1] check for correct build(s)                                 │
  # ╰──────────────────────────────────────────────────────────────────╯

  deployment:
    name: ⛽️ JOB /:/ deploy
    runs-on: ubuntu-22.04
    environment:
      name: staging
      url: https://betarena-scores-platform.herokuapp.com/
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.ref }}
      - name: 'STEP /:/ install heroku-cli'
        run: |
          curl https://cli-assets.heroku.com/install.sh | sh
      - name: 'STEP /:/ set environment variables'
        run: |
          echo "gitAuthorEmail=$(git show -s --format='%ae' HEAD)" >> $GITHUB_ENV
      - uses: akhileshns/heroku-deploy@v3.14.15
        with:
          heroku_api_key: ${{ secrets.HEROKU_API_KEY }}
          heroku_email: ${{ env.gitAuthorEmail }}
          heroku_app_name: "betarena-scores-platform"
        env:
          CI_GITHUB_DEPLOYMENT_STAGING: "true"
  #
#