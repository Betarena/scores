<!--
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸ“Œ High Order Overview                                                           â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ â¤ Code Format   // V.8.0                                                         â”‚
â”‚ â¤ Status        // ğŸ”’ LOCKED                                                     â”‚
â”‚ â¤ Author(s)     // @migbash                                                      â”‚
â”‚ â¤ Maintainer(s) // @migbash                                                      â”‚
â”‚ â¤ Created on    // <date-created>                                                â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ ğŸ“ Description                                                                   â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ BETARENA (Module)
â”‚ |: Scores Main Layout Component
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
-->

<!--
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸŸ¦ Svelte Component JS/TS                                                        â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ â¤ HINT: â”‚ Access snippets for '<script> [..] </script>' those found in           â”‚
â”‚         â”‚ '.vscode/snippets.code-snippets' via intellisense using 'doc'          â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
-->

<script lang="ts">

  // #region â¤ ğŸ“¦ Package Imports

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ NOTE:                                                                  â”‚
  // â”‚ Please add inside 'this' region the 'imports' that are required        â”‚
  // â”‚ by 'this' .svelte file is ran.                                         â”‚
  // â”‚ IMPORTANT                                                              â”‚
  // â”‚ Please, structure the imports as follows:                              â”‚
  // â”‚ 1. svelte/sveltekit imports                                            â”‚
  // â”‚ 2. project-internal files and logic                                    â”‚
  // â”‚ 3. component import(s)                                                 â”‚
  // â”‚ 4. assets import(s)                                                    â”‚
  // â”‚ 5. type(s) imports(s)                                                  â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  import { browser } from '$app/environment';
  import { afterNavigate, beforeNavigate } from '$app/navigation';
  import { page } from '$app/stores';
  import * as Sentry from '@sentry/sveltekit';
  import { onDestroy, onMount } from 'svelte';

  import {
    routeIdContent,
    routeIdPageProfile,
    routeIdPageProfileArticleCreation,
    routeIdPageProfileEditArticle,
    routeIdPageProfilePublication,
    routeIdSearch,
  } from '$lib/constants/paths.js';
  import { scoresAdminStore } from '$lib/store/admin.js';
  import { delCookie } from '$lib/store/cookie.js';
  import sessionStore from '$lib/store/session.js';
  import { initiateSubscribtions } from '$lib/store/subscribtions.js';
  import userBetarenaSettings from '$lib/store/user-settings.js';
  import { dlogv2 } from '$lib/utils/debug';
  import { mainDeepLinkCheck } from '$lib/utils/deeplink.js';
  import { isPWA, viewportChangeV2 } from '$lib/utils/device.js';
  import { setUserGeoLocation } from '$lib/utils/geo.js';
  import { parseObject } from '$lib/utils/string.2.js';
  import { initializeTopLevelConsoleController } from '$lib/utils/subscribtion.js';

  import AuthMain from '$lib/components/_main_/auth/Widget.svelte';
  import FooterWidget from '$lib/components/_main_/footer/v2/Footer.Widget.svelte';
  import HeaderRedesigned from '$lib/components/_main_/header_redisigned/HeaderRedesigned.svelte';
  import MobileMenu from '$lib/components/_main_/mobile-menu/MobileMenu.svelte';
  import SplashScreen from '$lib/components/misc/Splash-Screen.svelte';
  import DevInfoBox from '$lib/components/misc/admin/Dev-Info-Box.svelte';
  import ModalError from '$lib/components/misc/modal/Modal-Error.svelte';
  import ModalMain from '$lib/components/misc/modal/ModalMain.svelte';
  import ToastAuth from '$lib/components/misc/toast/Toast-Auth/Toast-Auth.svelte';
  import Login from '$lib/components/section/login/Login.svelte';
  import InfoMessages from '$lib/components/ui/infomessages/InfoMessages.svelte';
  import type { B_NAV_T } from '@betarena/scores-lib/types/navbar.js';
// import '@betarena/ad-engine';
  // import WidgetAdEngine from '@betarena/ad-engine/src/lib/Widget-AdEngine.svelte';
  import AndroidPwaBanner from '$lib/components/AndroidPWABanner.svelte';
  import { auth } from '$lib/firebase/init';
  import history_store from '$lib/store/history.js';
  import { modalStore } from '$lib/store/modal';
  import { successAuthComplete } from '$lib/utils/authentication';
  import WidgetAdEngine from '@betarena/ad-engine';

  // â•­â”€â”€â”€â”€â”€
  // â”‚ WARNING:
  // â”‚ |: Disable, if Dynamic Import is Enabled.
  // â•°â”€â”€â”€â”€â”€
  // import OfflineAlert from '$lib/components/Offline-Alert.svelte';
  // import PlatformAlert from '$lib/components/Platform-Alert.svelte';
  // import EmailSubscribe from '$lib/components/Email-Subscribe.svelte';

  // â•­â”€â”€â”€â”€â”€
  // â”‚ NOTE:
  // â”‚ |: moved to static/
  // â•°â”€â”€â”€â”€â”€
  // import '../app.css';

  // #endregion â¤ ğŸ“¦ Package Imports

  // #region â¤ ğŸ“Œ TYPES

  /**
   * @description
   *  ğŸ“£ Component `Type`.
   */
   type IDynamicComponentMap =
    | 'OfflineAlertDynamic'
    | 'PlatformAlertDynamic'
    | 'EmailSubscribeDynamic'
  ;

  // #endregion â¤ ğŸ“Œ TYPES

  // #region â¤ ğŸ“Œ VARIABLES

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ NOTE:                                                                  â”‚
  // â”‚ Please add inside 'this' region the 'variables' that are to be         â”‚
  // â”‚ and are expected to be used by 'this' .svelte file / component.        â”‚
  // â”‚ IMPORTANT                                                              â”‚
  // â”‚ Please, structure the imports as follows:                              â”‚
  // â”‚ 1. export const / let [..]                                             â”‚
  // â”‚ 2. const [..]                                                          â”‚
  // â”‚ 3. let [..]                                                            â”‚
  // â”‚ 4. $: [..]                                                             â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  const
    /**
     * @description
     * ğŸ“ (required) component state object
     */
    objComponentStandardState
      = {
        /**
         * @description
         * ğŸ“ Holds target `component(s)` of viewport configuration.
         */
        viewport:
          {
            mobile:
            {
              threshold: 575,
              state: true,
            },
            tablet:
            {
              threshold: 1160,
              state: true,
            }
          },
        /**
         * @description
         * ğŸ“ Holds target `component(s)` of dynamic nature.
         */
        mapStrDebugPreifix: new Map
          <
            'beforeNavigate' | 'afterNavigate',
            string
          >
          (
            [
              [ 'beforeNavigate', 'ğŸš checkpoint â¤ src/routes/+layout.svelte beforeNavigate(..)' ],
              [ 'afterNavigate', 'ğŸš checkpoint â¤ src/routes/+layout.svelte afterNavigate(..)' ]
            ]
          ),
        /**
         * @description
         * ğŸ“ Holds target `component(s)` of dynamic nature.
         */
        isDynamicImport: true,
        /**
         * @description
         *  ğŸ“ Holds target `component(s)` of dynamic nature.
         */
        mapComponentDynamicLoading: new Map < IDynamicComponentMap, any >()
      }
  ;
  /**
   * @description
   *  ğŸ“ Page unsubscribe to remove inside onDestroy.
   */
  let page_unsub: () => void;

  $: ({ currentPageRouteId, currentActiveModal, currentActiveToast, globalState, serverLang } = { ...$sessionStore });
  $: ({ theme } = { ...$userBetarenaSettings });
  $: ({ username, lang, competition_number } = { ...$userBetarenaSettings.user?.scores_user_data });
  $: ({ uid, email } = { ...$userBetarenaSettings.user?.firebase_user_data });
  $: ({ route: { id: pageRouteId } } = $page);

  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
  $: navbarTranslationData = ($page.data.B_NAV_T ?? {}) as
    | B_NAV_T
    | null
    | undefined
  ;
  $: deepReactListenStore1 = parseObject($sessionStore);
  $: deepReactListenStore2 = parseObject($userBetarenaSettings);

  $: $sessionStore.serverLang = $page.data.langParam as string;
  $: if (browser) $sessionStore.page = $page;
  $: isInitliazed = false;

  $: [ objComponentStandardState.viewport.mobile.state, objComponentStandardState.viewport.tablet.state]
    = viewportChangeV2
    (
      $sessionStore.windowWidth,
      objComponentStandardState.viewport.mobile.threshold,
      objComponentStandardState.viewport.tablet.threshold
    )
  ;

  $sessionStore.deviceType = $page.data.deviceType as 'mobile' | 'tablet' | 'desktop';
  $sessionStore.userAgent  = $page.data.userAgent as string ?? navigator.userAgent;

  // #endregion â¤ ğŸ“Œ VARIABLES

  // #region â¤ ğŸ› ï¸ METHODS

  /**
   * @description
   */
  async function herlperPreMountInitialize
  (
  ): Promise < void >
  {
    isInitliazed = true;
    userBetarenaSettings.useLocalStorage(serverLang);
    if (auth.currentUser) {
      successAuthComplete("login", auth.currentUser, undefined)
    }
    auth.currentUser
    scoresAdminStore.useLocalStorage();
    await mainDeepLinkCheck();

    return;
  }

  // #endregion â¤ ğŸ› ï¸ METHODS

  // #region â¤ ğŸ”¥ REACTIVIY [SVELTE]

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ NOTE:                                                                  â”‚
  // â”‚ Please add inside 'this' region the 'logic' that should run            â”‚
  // â”‚ immediately and/or reactively for 'this' .svelte file is ran.          â”‚
  // â”‚ WARNING:                                                               â”‚
  // â”‚ â—ï¸ Can go out of control.                                              â”‚
  // â”‚ (a.k.a cause infinite loops and/or cause bottlenecks).                 â”‚
  // â”‚ Please keep very close attention to these methods and                  â”‚
  // â”‚ use them carefully.                                                    â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  // â•­â”€â”€â”€â”€â”€
  // â”‚ NOTE: IMPORTANT CRITICAL
  // â”‚ â”‚: [instant] [once]
  // â”‚ â”‚: Instant critical data initialization.
  // â•°â”€â”€â”€â”€â”€
  $: if (browser && !isInitliazed)
    herlperPreMountInitialize();
  ;

  $: if (browser && pageRouteId)
    mainDeepLinkCheck();
  ;

  $: if ($userBetarenaSettings.user?.firebase_user_data?.uid) {
      
  }
  // â•­â”€â”€â”€â”€â”€
  // â”‚ NOTE: IMPORTANT CRITICAL
  // â”‚ â”‚: Hijack the 'console' object.
  // â•°â”€â”€â”€â”€â”€
  $: if (browser && document)
    initializeTopLevelConsoleController();
  ;

  // â•­â”€â”€â”€â”€â”€
  // â”‚ NOTE: IMPORTANT CRITICAL
  // â”‚ |: [3rd-party] Intercom Logic [show/hide]
  // â•°â”€â”€â”€â”€â”€
  $: if (browser && $page.route.id == routeIdPageProfile)
  {
    const
      /**
       * @description
       */
      intercom: HTMLElement = document.getElementsByClassName('intercom-lightweight-app')[0] as unknown as HTMLElement
    ;

    if (intercom != undefined)
      intercom.style.display = 'unset';
    ;
  }
  else if (browser)
  {
    const
      /**
       * @description
       * ğŸ“ HTLMElement instance of 'Intercom'
       */
      instanceIntercom = document.getElementsByClassName('intercom-lightweight-app')[0] as unknown as HTMLElement
    ;

    if (instanceIntercom)
      instanceIntercom.style.display = 'none';
    ;
  }

  // â•­â”€â”€â”€â”€â”€
  // â”‚ NOTE: IMPORTANT CRITICAL
  // â”‚ |: [3rd-party] Intercom Data Persistance
  // â•°â”€â”€â”€â”€â”€
  $: if (browser && (deepReactListenStore1 || deepReactListenStore2))
  {
    const intercomSettings
      = {
        api_base: 'https://api-iam.intercom.io',
        app_id: 'yz9qn6p3',
        name: username ?? '',
        email: email ?? `${uid}-unkown@gmail.com`,
        uid,
        lang: lang ?? 'en',
        competition_number: competition_number ?? 0,
      }
    ;
    window.intercomSettings = intercomSettings
    window.Intercom?.("boot", {
      ...intercomSettings,
      hide_default_launcher: true
    });

    page_unsub = page.subscribe(() => {
      window.Intercom?.('update', {
        hide_default_launcher: $sessionStore.currentPageRouteId !== "ProfilePage",
        last_request_at: Math.floor(Date.now() / 1000)
      })
    })
    // [ğŸ]
    Sentry.setContext
    (
      'ğŸ“¸ Data',
      {
        ...userBetarenaSettings.extractUserDataSnapshot(),
      }
    );
  }

  $: if (browser){
    // eslint-disable-next-line new-cap
    window.Intercom
    (
      'update',
      {
        hide_default_launcher: currentPageRouteId != 'ProfilePage',
      }
    );
    updateVh();
    window?.visualViewport?.addEventListener('resize', updateVh);
  }

  // #endregion â¤ ğŸ”¥ REACTIVIY [SVELTE]

  // #region â¤ ğŸ”„ LIFECYCLE [SVELTE]

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ NOTE:                                                                  â”‚
  // â”‚ Please add inside 'this' region the 'logic' that should run            â”‚
  // â”‚ immediately and as part of the 'lifecycle' of svelteJs,                â”‚
  // â”‚ as soon as 'this' .svelte file is ran.                                 â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  onDestroy(() => {
    if (!browser) return
    window?.visualViewport?.removeEventListener('resize', updateVh);
    page_unsub?.();
  })
  
  onMount
  (
    async (
    ): Promise < void > =>
    {

      $modalStore.component = Login;
      $modalStore.show = true;
      // â•­â”€â”€â”€â”€â”€
      // â”‚ IMPORTANT CRITICAL
      // â•°â”€â”€â”€â”€â”€
      initiateSubscribtions();

      if ('serviceWorker' in navigator)
        navigator.serviceWorker
          .register
          (
            '/progressier.js'
          )
          .then
          (
            (
              registration
            ) =>
            {
              // [ğŸ]
              // eslint-disable-next-line no-console
              console.log
              (
                'Service Worker registered with scope:',
                registration.scope
              );
            }
          )
          .catch
          (
            (
              error
            ) =>
            {
              // [ğŸ]
              // eslint-disable-next-line no-console
              console.error
              (
                'Service Worker registration failed:',
                error
              );
            }
          )
        ;
      ;

      // â•­â”€â”€â”€â”€â”€
      // â”‚ NOTE:
      // â”‚ |: Dynamic Import Logic
      // â•°â”€â”€â”€â”€â”€
      if (objComponentStandardState.isDynamicImport)
      {
        objComponentStandardState.mapComponentDynamicLoading.set
        (
          'OfflineAlertDynamic',
          (
            await import
            (
              '$lib/components/misc/banner/Banner-Offline-Alert.svelte'
            )
          ).default
        );

        objComponentStandardState.mapComponentDynamicLoading.set
        (
          'PlatformAlertDynamic',
          (
            await import
            (
              '$lib/components/misc/banner/Banner-Offline-Alert.svelte'
            )
          ).default
        );

        objComponentStandardState.mapComponentDynamicLoading.set
        (
          'EmailSubscribeDynamic',
          (
            await import
            (
              '$lib/components/misc/modal/Modal-Email-Subscribe.svelte'
            )
          ).default
        );
      }

      // â•­â”€â”€â”€â”€â”€
      // â”‚ NOTE: IMPORTANT
      // â”‚ |: Set initial values of 'windowWidth'.
      // â•°â”€â”€â”€â”€â”€
      sessionStore.updateData
      (
        [
          ['windowWidth', document.documentElement.clientWidth]
        ]
      );

      // â•­â”€â”€â”€â”€â”€
      // â”‚ NOTE: IMPORTANT
      // â”‚ |: Check if the current device is a PWA.
      // â•°â”€â”€â”€â”€â”€
      if (isPWA())
        $sessionStore.globalState.add('IsPWA');
      else
        $sessionStore.globalState.delete('IsPWA');
      ;

      setUserGeoLocation(navbarTranslationData!);

      const
        /**
         * @description
         */
        adminSet = $page.url.searchParams.get('admin')
      ;

      if (adminSet)
        scoresAdminStore.toggleAdminState(adminSet == 'true' ? true : false);
      ;

      return;
    }
  );

  beforeNavigate
  (
    async (
      _event
    ): Promise < void > =>
    {
      if (!browser) return;

      // [ğŸ]
      dlogv2
      (
        `${objComponentStandardState.mapStrDebugPreifix.get('beforeNavigate')} // START`,
        [
          `ğŸ”¹ [var] â¤ _event :: ${JSON.stringify(_event)}`
        ]
      );

      if ($page.data.setState?.has('IsAnonymousNewBurner'))
      {
        // [ğŸ]
        dlogv2
        (
          `${objComponentStandardState.mapStrDebugPreifix.get('beforeNavigate')} // IsAnonymousNewBurner`,
          []
        );

        delCookie
        (
          'betarenaScoresCookie'
        );
      }

      return;
    }
  );


  beforeNavigate(({from}) => {
    if (!from) return;
    const {url} = from;
    $history_store.push(url.pathname);
  })

  afterNavigate
  (
    async (
      e
    ): Promise < void > =>
    {
      if (!browser) return;

      sessionStore.updateData
      (
        [
          ['routeId', $page.route.id]
        ]
      );

      // [ğŸ]
      dlogv2
      (
        'ğŸš checkpoint â¤ src/routes/+layout.svelte afterNavigate(..)',
        [
          `ğŸ”¹ [var] â¤ e.from :|: ${JSON.stringify(e)}`
        ]
      );

      return;
    }
  );

  // #endregion â¤ ğŸ”„ LIFECYCLE [SVELTE]

  function updateVh() {
    if (!browser) return;
    const vh = (window?.visualViewport?.height || window?.innerHeight) * 0.01;
    document.body.style.setProperty('--vh', `${vh}px`);
  }

</script>

<!--
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸ’‰ Svelte Injection Tags                                                         â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
-->

<svelte:head>
  {#if theme === "Dark"}
  <meta
    name="theme-color"
    content="#1f1f1f"
    />
  {:else}
    <meta
      name="theme-color"
      content="#ffffff" />
  {/if}

  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  <script>
    // We pre-filled your app ID in the widget URL: 'https://widget.intercom.io/widget/yz9qn6p3'
    (
      function ()
      {
        var w = window;
        var ic = w.Intercom;
        if (typeof ic === "function")
        {
          ic("reattach_activator");
          ic("update", w.intercomSettings);
        }
        else
        {
          var d = document;
          var i = function () {
            i.c(arguments);
          };
          i.q = [];
          i.c = function (args) {
            i.q.push(args);
          };
          w.Intercom = i;
          var l = function () {
            var s = d.createElement("script");
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://widget.intercom.io/widget/yz9qn6p3";
            var x = d.getElementsByTagName("script")[0];
            x.parentNode.insertBefore(s, x);
          };
          if (document.readyState === "complete") {
            l();
          } else if (w.attachEvent) {
            w.attachEvent("onload", l);
          } else {
            w.addEventListener("load", l, false);
          }
        }
      }
    )();
  </script>
</svelte:head>

<svelte:document
  on:visibilitychange=
  {
    () =>
    {
      if (!document.hidden)
      {
        $sessionStore.isUserActive = true;
        return;
      }
      $sessionStore.isUserActive = false;
      return;
    }
  }
/>

<svelte:window
  on:resize=
  {
    () =>
    {
      sessionStore.updateData
      (
        [
          ['windowWidth', document.documentElement.clientWidth],
        ]
      );

      if (isPWA())
        $sessionStore.globalState.add('IsPWA');
      else
        $sessionStore.globalState.delete('IsPWA');
      ;

      return;
    }
  }
/>

<!--
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸ’  Svelte Component HTML                                                         â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ â¤ HINT: â”‚ Use 'Ctrl + Space' to autocomplete global class=styles, dynamically    â”‚
â”‚         â”‚ imported from './static/app.css'                                       â”‚
â”‚ â¤ HINT: â”‚ access custom Betarena Scores VScode Snippets by typing emmet-like     â”‚
â”‚         â”‚ abbrev.                                                                â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
-->

<div
  class="app-wrapper"
  id="app-root-layout"
  class:dark-mode={theme == 'Dark'}
  class:light-mode={theme == 'Light'}
  class:page-content={[routeIdContent, routeIdSearch].includes($page.route.id || "")}
  data-page-id={currentPageRouteId}
  data-mode={globalState.has('IsPWA') ? 'pwa' : 'web'}
>
  {#key $page.route.id}
    <WidgetAdEngine
      authorId={$page.data.dataArticle?.author?.id}
      authorArticleTagIds={$page.data.dataArticle?.article?.tags}
      isDarkTheme={theme == 'Dark'}
      strTranslationTarget={lang ?? 'en'}
    />
  {/key}

  <SplashScreen />

  {#if currentActiveModal == 'Auth_Modal'}
    <AuthMain />
  {/if}

  {#if currentActiveToast != null}
    <ToastAuth />
  {/if}

  {#if $scoresAdminStore.admin}
    <DevInfoBox />
  {/if}

  {#if currentActiveModal == 'GeneralPlatform_Error'}
    <ModalError />
  {/if}

  {#if objComponentStandardState.isDynamicImport}
    <svelte:component
      this={objComponentStandardState.mapComponentDynamicLoading.get('OfflineAlertDynamic')}
    />
  {:else}
    <!-- <OfflineAlert /> -->
  {/if}

  {#if objComponentStandardState.isDynamicImport}
    <svelte:component
      this={objComponentStandardState.mapComponentDynamicLoading.get('PlatformAlertDynamic')}
    />
  {:else}
    <!-- <PlatformAlert /> -->
  {/if}

  {#if objComponentStandardState.isDynamicImport}
    <svelte:component
      this={objComponentStandardState.mapComponentDynamicLoading.get('EmailSubscribeDynamic')}
    />
  {:else}
    <!-- <EmailSubscribe /> -->
  {/if}

  {#if ![routeIdPageProfileArticleCreation, routeIdPageProfileEditArticle, routeIdSearch].includes($page.route.id || "" ) || ($page.route.id === routeIdSearch && $sessionStore.viewportType !== "mobile") }
    <HeaderRedesigned />
  {/if}

  <main
    class:dark-mode={theme == 'Dark'}
    class:light-mode={theme == 'Light'}
    class:standard={currentPageRouteId == null }
    class:page-profile={currentPageRouteId == 'ProfilePage'}
    class:page-authors={currentPageRouteId == 'AuthorsPage' || currentPageRouteId == 'Standard' || $page.route.id === routeIdSearch }
    class:page-content={[routeIdContent, routeIdSearch].includes($page.route.id || "")}
    class:mobile={objComponentStandardState.viewport.mobile.state}
    class:tablet={objComponentStandardState.viewport.tablet.state}
  >
    <slot />

    {#if
      (
        !globalState.has('IsPWA')
        && ![routeIdPageProfileArticleCreation, routeIdPageProfileEditArticle].includes($page.route.id || '')
      )
      || [routeIdPageProfile, routeIdPageProfilePublication].includes($page.route.id || '')
    }
      <FooterWidget />
    {/if}

  </main>
  <InfoMessages />
  <ModalMain />

  {#if
    (objComponentStandardState.viewport.mobile.state || objComponentStandardState.viewport.tablet.state)
    && ![routeIdSearch, routeIdPageProfile, routeIdPageProfileEditArticle, routeIdPageProfileArticleCreation].includes($page.route.id || '')
  }
    <MobileMenu
      mobile={objComponentStandardState.viewport.mobile.state}
      tablet={objComponentStandardState.viewport.tablet.state}
    />
  {/if}


</div>

<AndroidPwaBanner />
<!--
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸŒŠ Svelte Component CSS/SCSS                                                     â”‚
â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
â”‚ â¤ HINT: â”‚ auto-fill/auto-complete iniside <style> for var()                      â”‚
â”‚         â”‚ values by typing/CTRL+SPACE                                            â”‚
â”‚ â¤ HINT: â”‚ access custom Betarena Scores CSS VScode Snippets by typing 'style...' â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
-->

<style lang="scss">

  /*
  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  â”‚ ğŸ“² MOBILE-FIRST                                                              â”‚
  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  */

  [data-page-id="AuthorsPage"][data-mode="pwa"] {
    background-color: var(--colors-background-bg-primary);
  }

  .app-wrapper {
    display: flex;
    flex-direction: column;
    min-height: calc(var(--vh)*100);
    &.page-content {
      background-color: var(--colors-background-bg-primary);
    }

    &[data-page-id="Standard"],
    &[data-page-id="CompetitionPage"] {
      &.light-mode {
        background-color: var(--whitev2);
      }
    }
  }

  main {
    /* ğŸ“Œ position */
    position: relative;
    z-index: 0;
    margin: 0 auto;
    flex-grow: 1;
    /* ğŸ¨ style */
    width: 100%;
    max-width: 100%;
    background: var(--colors-background-bg-primary);

    &.standard {
      &::before {
        /* ğŸ“Œ position */
        position: absolute;
        z-index: -1;
        top: -5px;
        /* ğŸ¨ style */
        content: "";
        display: inline-block;
        width: 100%;
        height: 435px;
        background-image: url("/assets/svg/header-background.svg");
        background-repeat: no-repeat;
        background-size: cover;
        background-origin: border-box;
        background-position: top;
      }
    }

    &.page-competition::before {
      /* ğŸ¨ style */
      display: none;
    }

    &.page-profile::before {
      /* ğŸ¨ style */
      height: 611px;
    }

    &.page-content {
      display: flex;
      overflow: visible;
      justify-content: space-between;
      max-width: 1265px;
      width: 100%;
      margin: auto;
      padding: 26px 34px;
      padding-top: 32px;
      gap: 34px;

      &.tablet {
        flex-direction: column;
        gap: 0;
        overflow: hidden;
        padding: 0;
      }
      &.mobile {
        padding: 0;
      }
    }
  }

  /*
  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  â”‚ âš¡ï¸ RESPONSIVNESS                                                              â”‚
  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
  */

  @media screen and (min-width: 768px) {
    main {
      &.standard {
        &::before {
          /* ğŸ¨ style */
          height: 495px;
        }
      }

      &.page-profile::before {
        /* ğŸ¨ style */
        height: 611px;
      }
    }
  }

  @media screen and (min-width: 1024px) {
    main {
      /* ğŸ¨ style */
      overflow: hidden;

      &.standard {
        &::before {
          /* ğŸ“Œ position */
          top: calc(100vw / -5.5) !important;
          /* ğŸ¨ style */
          height: 100%;
          background-size: contain !important;
        }
      }

      &.page-profile {
        /* ğŸ¨ style */
        overflow: visible;
      }

      &.page-profile::before {
        /* ğŸ¨ style */
        top: 0 !important;
        height: 10%; /*  939px :: 25% */
        background-size: cover !important;
      }
    }
  }

</style>
