// â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
// â”‚ ğŸ“Œ High Order Component Overview                                                 â”‚
// â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
// â”‚ â¤ Internal Svelte Code Format :|: V.8.0                                          â”‚
// â”‚ â¤ Status :|: ğŸ”’ LOCKED                                                           â”‚
// â”‚ â¤ Author(s) :|: @migbash                                                         â”‚
// â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
// â”‚ ğŸ“ Description                                                                   â”‚
// â”£â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”«
// â”‚ Main Scores Platform Page Loader ('Client-Side')                                 â”‚
// â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

// #region â¤ ğŸ“¦ Package Imports

import { redirect, ServerLoadEvent } from '@sveltejs/kit';

import { dlogv2, ERROR_CODE_INVALID } from '$lib/utils/debug.js';
import { preloadExitLogic, promiseUrlsPreload, promiseValidUrlCheck } from '$lib/utils/navigation.js';

import type { B_SAP_D2 } from '@betarena/scores-lib/types/seo-pages.js';
import type { IPageAuhtorArticleDataFinal } from '@betarena/scores-lib/types/v8/preload.authors.js';
import type { IPageArticleTranslationDataFinal } from '@betarena/scores-lib/types/v8/segment.authors.articles.js';

// #endregion â¤ ğŸ“¦ Package Imports

/**
 * @author
 *  @migbash
 * @summary
 *  ğŸ”¹ INTERFACE
 * @description
 *  ğŸ“£ Target `types` for `_this_` page required at preload.
 */
type PreloadPromise0 =
[
  IPageAuhtorArticleDataFinal | undefined,
  IPageArticleTranslationDataFinal | undefined,
  B_SAP_D2 | undefined
];

/**
 * @author
 *  @migbash
 * @summary
 *  ğŸŸ¥ MAIN
 * @description
 *  ğŸ“£ Logic for `[[lang=lang]]` route data preload.
 * @return { Promise < {} > }
 *  ğŸ“¤ Respective `data` for _this_ route.
 */
export async function main
(
  event: ServerLoadEvent,
  parentData:
  {
    langParam: string
  }
): Promise < {} >
{
  const
    // â•­â”€â”€â”€â”€â”€
    // â”‚ NOTE:
    // â”‚ |: Destructure `object`.
    // â•°â”€â”€â”€â”€â”€
    {
      permalink
    } = event.params,
    // â•­â”€â”€â”€â”€â”€
    // â”‚ NOTE:
    // â”‚ |: Destructure `object`.
    // â•°â”€â”€â”€â”€â”€
    {
      isValid,
      objRedirect
    } = await promiseValidUrlCheck
    (
      event.fetch,
      {
        authorArticleUrl: permalink
      }
    ),
    /**
     * @description
     *  ğŸ“ Initialize page response
     */
    response: any = {}
  ;

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ ğŸ“Ÿ â”‚ PERMALINK VALIDATION                                                        â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  if (objRedirect.isRedirect && objRedirect.strRedirectUrl != null)
    throw redirect
    (
      301,
      `/a${objRedirect.strRedirectUrl}`
    );
  else if (!isValid)
    preloadExitLogic
    (
      0,
      '(authors)',
      ERROR_CODE_INVALID
    );
  ;

  // â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
  // â”‚ ğŸ—ï¸ â”‚ PAGE DATA BUNDLING                                                          â”‚
  // â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

  [
    response.dataArticle,
    response.translationArticle,
    response.monthTranslations,
  ] = await fetchData
  (
    event.fetch,
    permalink,
    parentData.langParam
  );

  // [ğŸ]
  dlogv2
  (
    'ğŸš checkpoint â¤ src/routes/(authors)/a/[...permalink]/+page.server.ts',
    [
      // `ğŸ”¹ [var] â¤ response :|: ${JSON.stringify(response)}`,
    ],
    true
  );

  return response;
}

/**
 * @author
 *  @migbash
 * @summary
 *  ğŸŸ¦ HELPER
 * @description
 *  ğŸ“£ Fetches target data for `_this_` page.
 * @param { any } fetch
 *  ğŸ’  **[required]** Target instance of `fetch` object.
 * @param { string } _permalink
 *  ğŸ’  **[required]** Target `parmalink`.
 * @param { string } _lang
 *  ğŸ’  **[required]** Target `lang`.
 * @returns { Promise < IProfileData2 > }
 *  ğŸ“¤ Target `data` fetched.
 */
async function fetchData
(
  fetch: any,
  _permalink: string,
  _lang: string
): Promise < PreloadPromise0 >
{
  const
    /**
     * @description
     *  ğŸ“£ Target `urls` to be `fetched`.
     */
    urls0
      = [
        `/api/data/author/article?permalink=${_permalink}`,
        `/api/data/author/article?lang=${_lang}`,
        `/api/data/main/seo-pages?months=true&lang=${_lang}&decompress`,
      ],
    /**
     * @description
     *  ğŸ“£ Target `data` returned.
     */
    data0
      = await promiseUrlsPreload
      (
        urls0
        , fetch
      ) as PreloadPromise0
  ;

  return data0;
}
