<!--
╭──────────────────────────────────────────────────────────────────────────────────╮
│ 🟦 Svelte Component JS/TS                                                        │
┣──────────────────────────────────────────────────────────────────────────────────┫
│ ➤ HINT: │ Access snippets for '<script> [..] </script>' those found in           │
	import Header from './../../../_main_/header/Header.svelte';
│         │ '.vscode/snippets.code-snippets' via intellisense using 'doc'          │
╰──────────────────────────────────────────────────────────────────────────────────╯
-->

<script lang="ts">
  // #region ➤ 📦 Package Imports

  // ╭────────────────────────────────────────────────────────────────────────╮
  // │ NOTE:                                                                  │
  // │ Please add inside 'this' region the 'imports' that are required        │
  // │ by 'this' .svelte file is ran.                                         │
  // │ IMPORTANT                                                              │
  // │ Please, structure the imports as follows:                              │
  // │ 1. svelte/sveltekit imports                                            │
  // │ 2. project-internal files and logic                                    │
  // │ 3. component import(s)                                                 │
  // │ 4. assets import(s)                                                    │
  // │ 5. type(s) imports(s)                                                  │
  // ╰────────────────────────────────────────────────────────────────────────╯

  import ArrowLeftIcon from "$lib/components/ui/assets/ArrowLeftIcon.svelte";
  import Button from "$lib/components/ui/Button.svelte";
  import Progress from "$lib/components/ui/Progress.svelte";
  import { modalStore } from "$lib/store/modal";
  import { onMount } from "svelte";
  import DepositAmount from "./DepositAmount.svelte";
  import DepositConfirmation from "./DepositConfirmation.svelte";
  import DepositOptions from "./DepositOptions.svelte";
  import DepositRevolut from "./DepositRevolut.svelte";
  import DepositSuccess from "./DepositSuccess.svelte";

  // #endregion ➤ 📦 Package Imports

  // #region ➤ 📌 VARIABLES

  // ╭────────────────────────────────────────────────────────────────────────╮
  // │ NOTE:                                                                  │
  // │ Please add inside 'this' region the 'variables' that are to be         │
  // │ and are expected to be used by 'this' .svelte file / component.        │
  // │ IMPORTANT                                                              │
  // │ Please, structure the imports as follows:                              │
  // │ 1. export const / let [..]                                             │
  // │ 2. const [..]                                                          │
  // │ 3. let [..]                                                            │
  // │ 4. $: [..]                                                             │
  // ╰────────────────────────────────────────────────────────────────────────╯

  const steps = [
    {
      component: DepositOptions,
      buttonText: "Continue",
      buttonSupportText: "Funds will be added after confirmation.",
    },
    {
      component: DepositAmount,
      buttonText: "Continue",
      buttonSupportText: "Funds appear after confirmation",
    },
    {
      component: DepositRevolut,
      buttonText: "Proceed to Payment",
      buttonSupportText: "Redirecting to Revolut secure checkout",
    },
    {
      component: DepositConfirmation,
      buttonText: "Go to Dashboard",
      buttonSupportText: "",
    },
    {
      component: DepositSuccess,
      buttonText: "Go to Dashboard",
      buttonSupportText: "",
    },
  ];
  let currentStep = 0;
  let buttonDisabled = false;

  $: lastStep = currentStep === steps.length - 1;
  $: progress = ((currentStep + 1) / steps.length) * 100;

  // #endregion ➤ 📌 VARIABLES

  // #region ➤ 🛠️ METHODS

  // ╭────────────────────────────────────────────────────────────────────────╮
  // │ NOTE:                                                                  │
  // │ Please add inside 'this' region the 'methods' that are to be           │
  // │ and are expected to be used by 'this' .svelte file / component.        │
  // │ IMPORTANT                                                              │
  // │ Please, structure the imports as follows:                              │
  // │ 1. function (..)                                                       │
  // │ 2. async function (..)                                                 │
  // ╰────────────────────────────────────────────────────────────────────────╯

  function handleContinueClick() {
    if (lastStep) {
      $modalStore.show = false;
      return
    }
    currentStep = currentStep + 1;
  }

  function back() {
    if (!currentStep) {
      $modalStore.show = false;
      return;
    }
    currentStep = currentStep - 1;
  }
  // #endregion ➤ 🛠️ METHODS

  // #region ➤ 🔄 LIFECYCLE [SVELTE]

  // ╭────────────────────────────────────────────────────────────────────────╮
  // │ NOTE:                                                                  │
  // │ Please add inside 'this' region the 'logic' that should run            │
  // │ immediately and as part of the 'lifecycle' of svelteJs,                │
  // │ as soon as 'this' .svelte file is ran.                                 │
  // ╰────────────────────────────────────────────────────────────────────────╯

  onMount(() => {
    document.body.classList.add("disable-scroll");

    return () => {
      document.body.classList.remove("disable-scroll");
    };
  });

  // #endregion ➤ 🔄 LIFECYCLE [SVELTE]
</script>

<!--
╭──────────────────────────────────────────────────────────────────────────────────╮
│ 💠 Svelte Component HTML                                                         │
┣──────────────────────────────────────────────────────────────────────────────────┫
│ ➤ HINT: │ Use 'Ctrl + Space' to autocomplete global class=styles, dynamically    │
│         │ imported from './static/app.css'                                       │
│ ➤ HINT: │ access custom Betarena Scores VScode Snippets by typing emmet-like     │
│         │ abbrev.                                                                │
╰──────────────────────────────────────────────────────────────────────────────────╯
-->
<svelte:body class="disable-scroll" />
<div id="deposit-modal">
  <div class="header">
    {#if !lastStep}
      <div class="icon" on:click={back}>
        <ArrowLeftIcon />
      </div>
    {/if}
    {#if !lastStep}
      <div class="steps">
        Step {currentStep + 1} of {steps.length}
      </div>
    {:else}
      <div class="add-funds">Add Funds</div>
    {/if}
  </div>
  {#if !lastStep}
    <Progress animation={true} value={progress} />
  {/if}
  <div class="section-wrapper">
    {#if steps[currentStep]}
      <svelte:component
        this={steps[currentStep].component}
        bind:buttonDisabled
      />
    {/if}
  </div>
  <div class="footer">
    <Button full={true} on:click={handleContinueClick} disabled={buttonDisabled}
      >{steps[currentStep].buttonText}</Button
    >
    {#if lastStep}
      <Button
        full={true}
        type="secondary"
        on:click={() => {
          currentStep = 0;
        }}
        disabled={buttonDisabled}>Add More Funds</Button
      >
    {/if}
    {#if steps[currentStep].buttonSupportText}
      <span class="footer-text">{steps[currentStep].buttonSupportText}</span>
    {/if}
  </div>
</div>

<!--
╭──────────────────────────────────────────────────────────────────────────────────╮
│ 🌊 Svelte Component CSS/SCSS                                                     │
┣──────────────────────────────────────────────────────────────────────────────────┫
│ ➤ HINT: │ auto-fill/auto-complete iniside <style> for var()                      │
│         │ values by typing/CTRL+SPACE                                            │
│ ➤ HINT: │ access custom Betarena Scores CSS VScode Snippets by typing 'style...' │
╰──────────────────────────────────────────────────────────────────────────────────╯
-->

<style lang="scss">
  #deposit-modal {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    display: flex;
    width: 100dvw;
    height: 100dvh;
    padding: 0 var(--spacing-xl, 16px) var(--spacing-xl, 16px)
      var(--spacing-xl, 16px);
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-3xl, 24px);
    flex-shrink: 0;

    background: var(--colors-background-bg-primary, #1f1f1f);

    .header {
      display: flex;
      padding: 18px 4px;
      width: 100%;
      justify-content: space-between;
      align-items: center;
      align-self: stretch;

      .icon {
        color: var(--colors-foreground-fg-primary-900);
        cursor: pointer;
      }
      .steps {
        flex-grow: 1;
        color: var(--colors-text-text-tertiary-600, #8c8c8c);
        text-align: center;

        /* Text md/Medium */
        font-family: var(--font-family-font-family-body, Roboto);
        font-size: var(--font-size-text-md, 16px);
        font-style: normal;
        font-weight: 500;
        line-height: var(--line-height-text-md, 24px); /* 150% */
      }
      .add-funds {
        color: var(--colors-text-text-primary-900, #fff);
        text-align: center;
        flex-grow: 1;

        /* Text md/Medium */
        font-family: var(--font-family-font-family-body, Roboto);
        font-size: var(--font-size-text-md, 16px);
        font-style: normal;
        font-weight: 500;
        line-height: var(--line-height-text-md, 24px); /* 150% */
      }
    }
    .section-wrapper {
      width: 100%;
    }

    .footer {
      width: 100%;
      display: flex;
      padding: 0 0 var(--spacing-none, 0) 0;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      gap: 16px;
      flex: 1 0 0;
      align-self: stretch;

      .footer-text {
        color: var(--colors-text-text-tertiary-600, #8c8c8c);
        text-align: center;

        /* Text sm/Medium */
        font-family: var(--Font-family-font-family-body, Roboto);
        font-size: var(--Font-size-text-sm, 14px);
        font-style: normal;
        font-weight: 500;
        line-height: var(--Line-height-text-sm, 20px); /* 142.857% */
      }
    }
  }
</style>
